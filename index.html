<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Онлайн Java IDE (стиль IntelliJ, только проверка)</title>
  <link rel="stylesheet" href="style.css">
  <!-- Monaco Editor -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs/loader.min.js"></script>
</head>
<body>
  <!-- Верхняя панель -->
  <div id="toolbar">
    <button onclick="checkCode()">▶ Run (проверка)</button>
    <button onclick="formatCode()">⚙ Format</button>
  </div>

  <!-- Рабочая зона -->
  <div id="workspace">
    <div id="editor"></div>
    <pre id="console">[Console output]</pre>
  </div>

  <script>
    let editor;

    // Инициализация Monaco Editor
    require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs' }});
    require(['vs/editor/editor.main'], function () {
      editor = monaco.editor.create(document.getElementById('editor'), {
        value: 'class Main {\n    public static void main(String[] args) {\n        System.out.println("Hello, world!");\n    }\n}',
        language: 'java',
        theme: 'vs-dark',
        automaticLayout: true
      });
    });

    // Простая проверка кода на ошибки
    function checkCode() {
      const code = editor.getValue();
      const lines = code.split("\n");
      let errors = [];
      let openBraces = 0, openParentheses = 0, quoteToggle = false;

      lines.forEach((line, i) => {
        const trimmed = line.trim();
        const num = i + 1;

        // Проверка println
        if (trimmed.includes(".out.println") && !trimmed.endsWith(";")) {
          errors.push("Строка " + num + ": 'println' должна заканчиваться на ';'");
        }

        // Проверка System опечатки
        if (/\w+\.out\.println/.test(trimmed) && !/^System/.test(trimmed)) {
          errors.push("Строка " + num + ": ошибка в имени 'System'");
        }

        // Баланс скобок
        if (trimmed.includes("{")) openBraces++;
        if (trimmed.includes("}")) openBraces--;
        openParentheses += (trimmed.match(/KATEX_INLINE_OPEN/g) || []).length;
        openParentheses -= (trimmed.match(/KATEX_INLINE_CLOSE/g) || []).length;

        // Цитаты
        for (const c of trimmed) {
          if (c === '"') quoteToggle = !quoteToggle;
        }

        // Строка без ; и не служебные слова → ошибка
        if (
          trimmed.length > 0 &&
          !/[;{}]$/.test(trimmed) &&
          !/^(class|import|public|if|for|while|else|switch|try|catch)/.test(trimmed)
        ) {
          errors.push("Строка " + num + ": возможно пропущена ';'");
        }
      });

      // Глобальные проверки
      if (!/class\s+\w+/.test(code)) errors.push("Отсутствует объявление класса");
      if (!/void\s+main\s*KATEX_INLINE_OPEN/.test(code)) errors.push("Нет метода main()");

      if (openBraces !== 0) errors.push("Несбалансированные фигурные скобки { }");
      if (openParentheses !== 0) errors.push("Несбалансированные круглые скобки ( )");
      if (quoteToggle) errors.push("Незакрытые кавычки \" \"");

      // Выводим результат
      const consoleBox = document.getElementById("console");
      if (errors.length === 0) {
        consoleBox.textContent = "[Compilation successful]\n✅ Ошибок не найдено!";
        consoleBox.style.color = "#4caf50";
      } else {
        consoleBox.textContent = "[Compilation failed]\n" + errors.map(e => "❌ " + e).join("\n");
        consoleBox.style.color = "#ff4444";
      }
    }

    // Форматирование (простое trim)
    function formatCode() {
      const code = editor.getValue().trim();
      editor.setValue(code);
    }
  </script>
</body>
</html>
